<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard — Dashboard de Steam</title>
  <link rel="stylesheet" href="./styles.css" />
  <script src="./env.js"></script>
  <script defer src="./auth.js"></script>
  <script defer src="./app.js"></script>
  <script defer src="./reviews.js"></script>
</head>
<body onload="requireAuth()">
  <div class="container">
    <header class="header">
      <div class="brand"><span class="logo"></span> Dashboard de Steam</div>
      <div>
        <span id="userBadge" class="badge">Usuario</span>
        &nbsp;&nbsp;
        <button class="ghost" onclick="logout()">Salir</button>
      </div>
    </header>

    <div class="topbar">
      <h2 style="margin:0">Catálogo</h2>
      <div style="display:flex; gap:8px">
        <input id="q" class="input" placeholder="Buscar juegos..." />
        <button onclick="reloadGames()">Buscar</button>
        <button onclick="openCreate()">+ Agregar</button>
      </div>
    </div>

    <div id="grid" class="grid"></div>

    <!-- Modal Crear/Editar Juego -->
    <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <header>
          <h3 id="modalTitle">Nuevo juego</h3>
          <button class="ghost" onclick="closeModal()">Cerrar</button>
        </header>
        <form id="gameForm" class="form">
          <input type="hidden" name="id" />
          <div class="row">
            <input class="input" name="titulo" placeholder="Título" required />
            <input class="input" name="categoria" placeholder="Categoría" required />
          </div>
          <textarea class="input" name="descripcion" placeholder="Descripción" rows="4"></textarea>
          <input class="input" name="portada_url" placeholder="URL de portada (opcional)" />
          <div class="error" id="formError"></div>
          <div class="actions">
            <button type="button" class="ghost" onclick="closeModal()">Cancelar</button>
            <button type="submit">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Reseña -->
    <div id="reviewModalBackdrop" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="reviewModalTitle">
        <header>
          <h3 id="reviewModalTitle">Nueva reseña</h3>
          <button class="ghost" onclick="closeReviewModal()">Cerrar</button>
        </header>
        <form id="reviewForm" class="form">
          <input type="hidden" name="id" />
          <input type="hidden" name="game_id" />
          <div class="row">
            <input class="input" name="titulo" placeholder="Título de tu reseña" required />
            <input class="input" name="imagen_url" placeholder="URL de imagen (opcional)" />
          </div>
          <div class="row">
            <div>
              <label>Calificación:</label>
              <div id="starsInput" class="stars" role="radiogroup" aria-label="Calificación de 1 a 5">
                <span class="star" data-v="1">★</span>
                <span class="star" data-v="2">★</span>
                <span class="star" data-v="3">★</span>
                <span class="star" data-v="4">★</span>
                <span class="star" data-v="5">★</span>
              </div>
              <input type="hidden" name="rating" value="5" />
            </div>
            <div>
              <label>o Subir imagen (opcional):</label>
              <input class="input" type="file" id="imagen_file" accept="image/*" />
              <div class="helper">Si subes archivo, se intentará subir y obtener URL del backend.</div>
            </div>
          </div>
          <textarea class="input" name="contenido" placeholder="Escribe tu reseña..." rows="4" required></textarea>
          <div class="error" id="reviewFormError"></div>
          <div class="actions">
            <button type="button" class="ghost" onclick="closeReviewModal()">Cancelar</button>
            <button type="submit">Guardar reseña</button>
          </div>
        </form>
      </div>
    </div>

  </div>
</body>
</html>
